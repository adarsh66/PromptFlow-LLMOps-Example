# FROM mcr.microsoft.com/azureml/promptflow/promptflow-runtime:latest
# COPY ./requirements.txt .
# RUN pip install -r requirements.txt
FROM docker.io/continuumio/miniconda3:latest

WORKDIR /

COPY ./requirements.txt .

RUN apt-get update && apt-get install -y runit gcc

# create conda environment
RUN conda create -n promptflow-serve python=3.12.4 pip=24.2 -q -y && \
    conda run -n promptflow-serve \
    pip install -r /flow/requirements.txt && \
    conda run -n promptflow-serve pip install keyrings.alt && \
    conda run -n promptflow-serve pip install gunicorn==20.1.0 && \
    conda run -n promptflow-serve pip install uvicorn && \
    conda run -n promptflow-serve pip cache purge && \
    conda clean -a -y
